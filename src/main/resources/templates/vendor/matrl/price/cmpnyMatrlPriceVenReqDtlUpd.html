<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="_layout/layout">
<th:block layout:fragment="contentFragment" th:with="hasUpdate=${rst.pageType=='UPD' && rst.reqStatCd=='10'}">

<!-- TODO DELETE -->
<pre id="DEV_MEMO_DIV" style="padding:0; margin:0; display:none;">
</pre>

<script type="text/javascript">
jQuery(document).ready(function() {
    jQuery(document.forms.sForm).submit(doSubmit);
});
function doSubmit() {
	if ( !confirm("작성한 '메모'와 함께 '제안가격'으로 '수정요청'합니다.") ) {
		return false;
	}
    return true;
}
function doConfirm() {
    if ( !confirm("!!!주의!!! 입력한 수정내용은 반영되지 않습니다.\n\n최종 '요청가격'으로 '확정'처리합니다.") ) {
        return false;
    }
    return true;
}
</script>

<h1 class="page_title">
    업체 공급단가 등록 요청<b th:text="${cmpny.cmpnyNm}">업체명</b>
    <div class="tit_btn_area">
        <a href="#" th:href="@{/vendor/matrl/price/cmpnyMatrlPriceVenDtlList(cmpnyId=${param.cmpnyId})}" class="BTNS icon cancel"><span>취소</span></a>
        <a href="#" th:if="${hasUpdate}" onclick="jQuery(document.forms.sForm).submit();" class="BTNS icon edit"><span>수정요청</span></a>
        <a href="#" th:if="${hasUpdate}" th:href="@{/vendor/matrl/price/cmpnyMatrlPriceReqConfirm(cmpnyId=${param.cmpnyId}, aplStrtDt=${param.aplStrtDt})}" onclick="return doConfirm();" class="BTNS icon regist"><span>확정</span></a>
    </div>
</h1>
<!-- //////////////////// Content List -->
<div class="LIST_BOX">
    <!-- Info list Top -->
    <div class="con_info_top">
        <table>
            <thead>
                <tr>
                    <th>진행상태</th>
<!--                     <th>구매방식</th> -->
                    <th>품목</th>
                    <th>세부품목</th>
                    <th>단가 적용기간</th>
                    <th>담당자</th>
                    <th>요청일</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td th:text="${rst.reqStatCd}">reqStatCd</td>
<!--                     <td>구매</td> -->
                    <td>xx</td>
                    <td>xx</td>
                    <td th:text="|${#temporals.createDate(rst.aplStrtDt, 'yyyyMMdd')} ~ ${#temporals.createDate(rst.aplEndDt, 'yyyyMMdd')}|">2020/01/01 ~ 2020/12/31</td>
                    <td class="man">
                        <span>xxx</span>
                        <span>(xxx-xxxx-xxxx)</span>
                    </td>
                    <td th:text="${#temporals.createDate(rst.reqDt, 'yyyyMMdd')}">reqDt</td>
                </tr>
            </tbody>
        </table>
    </div>
<form name="sForm" method="post"
		action="/vendor/matrl/price/cmpnyMatrlPriceReqUpdate"
		th:with="rstList_10_size = ${rstList_10 == null ? 0 : rstList_10.size}, rstList_20_size = ${rstList_20 == null ? 0 : rstList_20.size}">
    <input type="hidden" name="cmpnyId" th:value="${param.cmpnyId}" />
    <input type="hidden" name="aplStrtDt" th:value="${rst.aplStrtDt}" />
    <input type="hidden" name="aplEndDt" th:value="${rst.aplEndDt}" />
    <input type="hidden" name="reqDt" th:value="${rst.reqDt}" />
    <input type="hidden" name="title" th:value="|${#strings.substring(rst.aplStrtDt,0,4)}년도 구매자재 공급단가|" />
    <div class="list_table">
        <table>
            <thead>
                <tr>
                    <th class="sz_50">No</th>
                    <th class="sz_120">작성일</th>
                    <th>회사명</th>
                    <th class="sz_200">담당자</th>
                    <th>내용</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <input type="hidden" name="memoSeq" th:value="${memoList != null ? memoList[0].memoSeq + 1 : 1}">
                        <input type="text"   name="memoCont" th:readonly="${!hasUpdate}" placeholder="메모를 남겨주세요." class="t_inp">
                    </td>
                </tr>
<!--                 <tr class="grey"> -->
<!--                     <td>2</td> -->
<!--                     <td>2021.03.10</td> -->
<!--                     <td>지엠테크</td> -->
<!--                     <td>김길동 (010-1234-5678)</td> -->
<!--                     <td class="t_left">3% 인상된 가격으로 제안드립니다. 확인 부탁드립니다.</td> -->
<!--                 </tr> -->
                <tr th:each="memoLi,index : ${memoList}" th:classappend="${index.index % 2 == 0} ? grey">
                    <td th:text="${index.size - index.index}">xx</td>
                    <td th:text="${#calendars.format(memoLi.modDts,'yyyy-MM-dd HH:mm')}">reqDt</td>
                    <td>원영건업</td>
                    <td th:text="${memoLi.modpeId}">김길동 (010-1234-5678)</td>
                    <td th:text="${memoLi.memoCont}" class="t_left">메모내용</td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Search Result, buttons -->
    <div class="list_top_area">
        <div class="list_search_result">
            아래의 공급품목에 대한 공급단가를 요청합니다.
        </div>
        <div class="list_top_btn_box">
            <a href="#" class="BTNS icon preview"><span>단가 시물레이션</span></a>
        </div>
    </div>
    <!-- Search Area -->
    <div class="con_search_box">
        <!-- Select -->
        <div class="search_inp_box">
            <select class="top_inp">
                <option>중분류명</option>
            </select>
            <select class="top_inp">
                <option>소분류명</option>
            </select>
            <select class="top_inp">
                <option>품목</option>
            </select>
            <input type="text" class="top_inp" placeholder="품목명을 입력하세요" />
            <a href="#" class="BTNS icon search"><span>검색</span></a>
            <a href="#" class="BTNS icon reset"><span>초기화</span></a>
        </div>
        <!-- Button Area -->
        <div class="fuc_btns_box">
            <!-- 버튼이 있는 경우 노출 -->
        </div>
    </div>
    <div class="list_table" th:if="${rstList_10_size > 0}">
        <table>
            <thead>
                <tr>
                    <th class="sz_50">No</th>
                    <th>중분류</th>
                    <th>소분류</th>
                    <th>품목</th>
                    <th>세부품목</th>
                    <th class="sz_70">단위</th>
                    <th class="sz_200">요청(희망)가격</th>
                    <th class="sz_200">제안가격</th>
                    <th>인상률</th>
                    <th>공급가격(현재)</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="rstLi,index : ${rstList_10}">
                    <td th:text="${index.size - index.index}">xx</td>
                    <td th:text="${rstLi.mctgNm}">mctgNm</td>
                    <td th:text="${rstLi.ctgNm}">ctgNm</td>
                    <td th:text="${rstLi.itemNm}">itemNm</td>
                    <td th:text="${rstLi.matrlStd}">matrlStd</td>
                    <td th:text="${rstLi.unitCd}">unitCd</td>
                    <td class="t_right org" th:text="${#numbers.formatInteger(rstLi.reqPrice, 3, 'COMMA')}">0</td>
                    <td class="t_right gre">
                        <input type="text"   th:name="|matrlPriceList[${index.index}].sugstPrice|" th:readonly="${!hasUpdate}" th:value="${#numbers.formatInteger(rstLi.sugstPrice, 3, 'COMMA')}" class="t_inp">
                        <input type="hidden" th:name="|matrlPriceList[${index.index}].matrlId|"  th:value="${rstLi.matrlId}" />
                        <input type="hidden" th:name="|matrlPriceList[${index.index}].buyTypeCd|"  th:value="${rstLi.buyTypeCd}" />
                    </td>
                    <td class="t_right">0%</td>
                    <td class="t_right" th:text="${#numbers.formatInteger(rstLi.price, 3, 'COMMA')}">0</td>
                </tr>
<!--                 <tr> -->
<!--                     <td>3</td> -->
<!--                     <td>가설자재</td> -->
<!--                     <td>유로폼</td> -->
<!--                     <td>유로폼(고재)</td> -->
<!--                     <td>450 * 500 * 1200</td> -->
<!--                     <td>EA</td> -->
<!--                     <td class="t_right org">10,000</td> -->
<!--                     <td class="t_right gre"><input type="text" value="10,000" class="t_inp" /></td> -->
<!--                     <td class="t_right">0%</td> -->
<!--                     <td class="t_right">10,000</td> -->
<!--                 </tr> -->
            </tbody>
        </table>
    </div>
    <div class="list_table" th:if="${rstList_20_size > 0}">
        <table>
            <thead>
				<tr>
				    <th rowspan="2" class="sz_50">No</th>
				    <th rowspan="2">중분류</th>
				    <th rowspan="2">소분류</th>
				    <th rowspan="2">품목</th>
				    <th rowspan="2">세부품목</th>
				    <th rowspan="2">단위</th>
				    <th colspan="2">요청(희망)가격</th>
				    <th colspan="2">제안가격</th>
				    <th colspan="3">기존 임대 단가</th>
				</tr>
				<tr>
				    <th class="sz_120">기본료</th>
				    <th class="sz_120">임대료</th>
				    <th class="sz_120">기본료</th>
				    <th class="sz_120">임대료</th>
				    <th class="sz_50">기준</th>
				    <th class="sz_120">기본료</th>
				    <th class="sz_120">임대료</th>
				</tr>
            </thead>
            <tbody>
				<tr th:each="rstLi,index : ${rstList_20}">
				    <td th:text="${index.size - index.index}">xx</td>
				    <td th:text="${rstLi.mctgNm}">mctgNm</td>
                    <td th:text="${rstLi.ctgNm}">ctgNm</td>
                    <td th:text="${rstLi.itemNm}">itemNm</td>
                    <td th:text="${rstLi.matrlStd}">matrlStd</td>
                    <td th:text="${rstLi.unitCd}">unitCd</td>
				    <td class="t_right org" th:text="${#numbers.formatInteger(rstLi.reqPrice, 3, 'COMMA')}">1,000</td>
				    <td class="t_right org" th:text="${#numbers.formatInteger(rstLi.reqLeasePrice, 3, 'COMMA')}">100</td>
				    <td class="t_right gre">
				        <input type="text" th:name="|matrlPriceList[${rstList_10_size + index.index}].sugstPrice|" th:readonly="${!hasUpdate}" th:value="${rstLi.sugstPrice}" class="t_inp" />
                        <input type="hidden" th:name="|matrlPriceList[${rstList_10_size + index.index}].matrlId|" th:value="${rstLi.matrlId}" />
                        <input type="hidden" th:name="|matrlPriceList[${rstList_10_size + index.index}].buyTypeCd|" th:value="${rstLi.buyTypeCd}" />
                        <input type="hidden" th:name="|matrlPriceList[${rstList_10_size + index.index}].leasePerdCd|" th:value="${rstLi.leasePerdCd}" />
				    </td>
				    <td class="t_right gre">
				        <input type="text" th:name="|matrlPriceList[${rstList_10_size + index.index}].sugstLeasePrice|" th:readonly="${!hasUpdate}" th:value="${rstLi.sugstLeasePrice}" class="t_inp" />
				    </td>
		            <td th:text="${rstLi.leasePerdCd}">일</td>
                    <td class="t_right" th:text="${#numbers.formatInteger(rstLi.price, 3, 'COMMA')}">0</td>
                    <td class="t_right" th:text="${#numbers.formatInteger(rstLi.leasePrice, 3, 'COMMA')}">0</td>
				</tr>
<!--                 <tr> -->
<!--                     <td>2</td> -->
<!--                     <td>가설자재</td> -->
<!--                     <td>유로폼</td> -->
<!--                     <td>유로폼(고재)</td> -->
<!--                     <td>450 * 500 * 1200</td> -->
<!--                     <td>EA</td> -->
<!--                     <td class="t_right acc sz_100"><input type="text" value="10,000" class="t_inp"></td> -->
<!--                     <td class="t_right acc sz_100"><input type="text" value="10,000" class="t_inp"></td> -->
<!--                     <td class="t_right def sz_100">3,000</td> -->
<!--                     <td class="t_right def sz_100">350</td> -->
<!--                     <td class="sz_50">일</td> -->
<!--                     <td class="t_right sz_100">1,000</td> -->
<!--                     <td class="t_right sz_100">150</td> -->
<!--                 </tr> -->
            </tbody>
        </table>
    </div>
</form>
</div>
<!-- Content List //////////////////// -->

</th:block>